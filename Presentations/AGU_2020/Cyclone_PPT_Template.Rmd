---
title: "Untitled"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(crosstalk)
library(plotly)
library(sf)
library(tidyverse)
library(here)
library(leaflet)
library(RColorBrewer)

# Import track
names <- data.frame(ID = substr(list.files(here("Data/NOAA/officialTracks/landfalls/"),recursive = TRUE,full.names = FALSE, pattern = "lin.shp$"),1,8))

list <- data.frame(path = list.files(here("Data/NOAA/officialTracks/landfalls/"),recursive = TRUE,full.names = TRUE, pattern = "lin.shp$"))%>%
  cbind(names)

file <- list%>%
  filter(ID %in% subgroup$Storm)

track <- st_read(file[1,1])

# Create shared data
sd_sf <- SharedData$new(subgroup, ~cell_id, group = "ppt")
sd_df <- SharedData$new(as.data.frame(subgroup), ~cell_id, group = "ppt")

# MAPBOX token
Sys.setenv('MAPBOX_TOKEN' = 'pk.eyJ1IjoiYXJtdXJyYXkxODkiLCJhIjoiY2tpN2V2emNmMnI5bzJ4cDV3cnhtaWNqZCJ9.fwZ79nuMzsPeljHb-j5Cbw')
```

Column {sidebar}
-----------------------------------------------------------------------

### Filters

```{r}
filter_slider(
    id = "sliderid",
    label = "Precipitation [mm]",
    sharedData = sd_df,
    column = ~ppt_mm,
    step = 25,
    sep = "",
    ticks = FALSE
  )
```

Column {}
-----------------------------------------------------------------------

### `r paste0(subgroup$nameYear[1])`

```{r}
plot_mapbox(sd_sf, colors = pal)%>%
  add_sf(color = ~fct_reorder(Class,ppt_mm),
         hoverinfo = "text",
         text = ~paste(Name, "<br>",
                       "Storm Name: ",Name, "<br>",
                       "Landfall: ", lFall_dateTime, "<br>",
                       "Max Sustained Windspeed: ", maxIntensity, "<br>",
                       "Total Precipitation: ", ppt_mm," [mm]"
         ))%>%
  add_sf(data = track, line = list(color = 'rgba(67,67,67,1)', width = 2))
```

